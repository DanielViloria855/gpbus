<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Pasajero</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #e8f5e9;
            color: #2e7d32;
            font-family: Arial, sans-serif;
        }
        .container {
            background: #ffffff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        .logo-container {
            text-align: center;
            margin-top: 20px;
        }
        .Logo {
            width: 5px;
            height: 10px;
        }
        h1 {
            text-align: center;
            color: #1b5e20;
            font-weight: bold;
            margin-bottom: 20px;
        }
        #map {
            height: 400px;
            width: 100%;
            border-radius: 15px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }
        .btn-green {
            background-color: #2e7d32;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px;
            font-size: 16px;
            transition: 0.3s;
        }
        .btn-green:hover {
            background-color: #1b5e20;
        }
        select {
            border: 2px solid #2e7d32;
            border-radius: 8px;
            padding: 8px;
            font-size: 16px;
        }
        #infoRuta {
            background: #f1f8e9;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: 0px 3px 7px rgba(0, 0, 0, 0.1);
            display: none;
        }
        #infoRuta h4 {
            text-align: center;
            font-weight: bold;
            color: #1b5e20;
            margin-bottom: 15px;
        }
        .info-item {
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="logo-container">
        <img src="{{ url_for('static', filename='img/gp.png') }}" alt="Logo" width="120" height="90">
    </div>
    
    <div class="container">
        <h1>Bienvenido, {{ usuario.nombre }} (Pasajero)</h1>
        
        <div id="map"></div>

        <button id="getLocation" class="btn btn-green w-100 mt-3">Obtener mi ubicación</button>

        <div class="mt-3">
            <label for="destino" class="fw-bold">Selecciona tu destino:</label>
            <select id="destino" class="form-select">
                <option value="" disabled selected>Elige un destino</option>
                <option value="San Cristóbal">San Cristóbal</option>
                <option value="San Félix">San Félix</option>
                <option value="Ovejas">Ovejas</option>
                <option value="San Pedro">San Pedro</option>
            </select>
            <button id="trazarRuta" class="btn btn-green w-100 mt-3">Trazar Ruta</button>
        </div>

        <div id="infoRuta">
            <h4>Detalles de la Ruta</h4>
            <p class="info-item"><strong>Distancia:</strong> <span id="distancia"></span></p>
            <p class="info-item"><strong>Duración:</strong> <span id="duracion"></span></p>
            <p class="info-item"><strong>Precio Estimado:</strong> $<span id="precio"></span></p>
        </div>
    </div>

    <script>
        let map, marker, directionsService, directionsRenderer, userLocation = null;

        const destinos = {
            "San Cristóbal": { lat: 6.2776756780403, lng: -75.63576287054343 },
            "San Félix": { lat: 6.4473, lng: -75.5818 },
            "Ovejas": { lat: 6.395945877792119, lng:-75.64706782754776 },
            "San Pedro": { lat: 6.459531328629943, lng: -75.55972875682015 }
        };

        function initMap() {
            const defaultLocation = { lat: 6.2442, lng: -75.5812 };
            map = new google.maps.Map(document.getElementById("map"), { zoom: 12, center: defaultLocation });
            marker = new google.maps.Marker({ position: defaultLocation, map: map });
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
        }

        document.getElementById("getLocation").addEventListener("click", function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    userLocation = { lat: position.coords.latitude, lng: position.coords.longitude };
                    alert(`Ubicación detectada: Latitud ${userLocation.lat}, Longitud ${userLocation.lng}`);
                    map.setCenter(userLocation);
                    marker.setPosition(userLocation);
                }, function(error) {
                    console.error("Error obteniendo ubicación:", error);
                    alert("Error al obtener ubicación: " + error.message);
                });
            } else {
                alert("Tu navegador no soporta geolocalización.");
            }
        });

        document.getElementById("trazarRuta").addEventListener("click", function() {
            if (!userLocation) {
                alert("Primero obtén tu ubicación.");
                return;
            }

            const destinoSeleccionado = document.getElementById("destino").value;
            if (!destinoSeleccionado) {
                alert("Selecciona un destino antes de trazar la ruta.");
                return;
            }

            const destino = destinos[destinoSeleccionado];
            directionsService.route(
                {
                    origin: userLocation,
                    destination: destino,
                    travelMode: google.maps.TravelMode.DRIVING
                },
                function(result, status) {
                    if (status === "OK") {
                        directionsRenderer.setDirections(result);
                        mostrarInfoRuta(result);
                    } else {
                        alert("No se pudo calcular la ruta.");
                    }
                }
            );
        });

        function mostrarInfoRuta(result) {
            const ruta = result.routes[0].legs[0];
            const distanciaKm = ruta.distance.value / 1000;
            const duracion = ruta.duration.text;
            const precio = calcularPrecio(distanciaKm);
            document.getElementById("distancia").textContent = distanciaKm.toFixed(2) + " km";
            document.getElementById("duracion").textContent = duracion;
            document.getElementById("precio").textContent = precio.toFixed(2);
            document.getElementById("infoRuta").style.display = "block";
        }

        function calcularPrecio(distanciaKm) {
            return 3500 + (distanciaKm * 200);
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3BqEEhWiOdduk3jnRVwR8DTEIIehTSQo&callback=initMap&libraries=places,geometry&solution_channel=GMP_QB_commutes_v3_c" async defer></script>

</body>
</html>
